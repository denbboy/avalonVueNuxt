<template>
    <footer id="contacts" class="mt-a bg-blue-600 pt-14 md:pt-24 mt-auto z-10">
        <div class="container">

            <div class="xl:flex xl:items-center gap-5 justify-between md:mb-24">
                <img :src="`https://avalon-panel.sonisapps.com/assets/${toolkitStore?.settings?.footer_img}`"
                    class="lg:max-w-[379px] md:max-w-[338px] w-full hidden xl:block" alt="ph">

                <!-- <div class="logo-clip-path hidden lg:block">
                    <video loop class="w-[379px] h-[392px] object-cover" muted autoplay
                        src="/assets/video/video-logo.webm"></video>
                </div> -->

                <div class="w-fit">
                    <div class="md:mb-[30px] md:pb-[30px] border-b border-white/10 mb-5 pb-5">
                        <a :href="toolkitStore?.settings?.soc_link_whats" target="_blank"
                            class="flex items-center gap-4 mb-7 md:gap-4 lg:gap-5 group">
                            <img src="/assets/img/index/whatsap.svg" class="w-[60px] h-[60px] 3xl:w-[70px] 3xl:h-[70px]"
                                alt="ic">
                            <div>
                                <span class="text-white/40 text-sm md:text-base md:mb-2">
                                    WhatsApp 24/7 online
                                </span>
                                <p
                                    class="text-white font-bold text-sm md:text-[16px] 3xl:text-xl group-hover:text-blue-400 transition-all">
                                    {{ toolkitStore?.settings?.phone }}
                                </p>
                            </div>
                        </a>
                        <a :href="`mailto:${toolkitStore?.settings?.email}`" target="_blank"
                            class="flex items-center gap-4 md:gap-5 group">
                            <img src="/assets/img/index/mail.svg" class="w-[60px] h-[60px] 3xl:w-[70px] 3xl:h-[70px]"
                                alt="ic">
                            <div>
                                <span class="text-white/40 text-sm md:text-base md:mb-2">
                                    Email us
                                </span>
                                <p
                                    class="text-white font-bold text-sm md:text-[16px] 3xl:text-xl group-hover:text-blue-400 transition-all">
                                    {{ toolkitStore?.settings?.email }}
                                </p>
                            </div>
                        </a>
                    </div>
                    <div class="flex gap-[5px] mb-5">
                        <a v-if="toolkitStore?.settings?.soc_link_whats" :href="toolkitStore?.settings?.soc_link_whats"
                            class="min-w-[45px] h-[45px] md:min-w-[60px] md:h-[60px] border border-whiteOp-300 rounded-full hover:bg-white transition-all flex items-center justify-center group">
                            <svg class="fill-white group-hover:fill-blue-600 w-[45%] transition-all" width="25"
                                height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M20.9118 4.14053C18.6096 1.83715 15.5481 0.567634 12.2866 0.566406C5.56551 0.566406 0.0956566 6.0338 0.093202 12.7549C0.0919747 14.9032 0.653452 17.0004 1.72036 18.8485L0.0664062 24.9799L6.45416 23.47C8.23513 24.4416 10.2395 24.953 12.2804 24.9543H12.2853C19.0052 24.9543 24.4749 19.4856 24.4786 12.7658C24.4811 9.50791 23.214 6.44515 20.9118 4.14053ZM18.2519 17.1115C17.9981 17.8231 16.7542 18.5091 16.1951 18.5591C15.6361 18.6104 15.1124 18.8119 12.5392 17.7974C9.44236 16.5768 7.4868 13.4018 7.33544 13.1991C7.18285 12.9953 6.0916 11.5476 6.0916 10.0486C6.0916 8.54961 6.8789 7.81233 7.15851 7.50837C7.43802 7.20319 7.76764 7.12751 7.97147 7.12751C8.17408 7.12751 8.37791 7.12751 8.55494 7.13487C8.77217 7.14346 9.01271 7.15441 9.24099 7.66096C9.51191 8.26396 10.104 9.77034 10.1796 9.92293C10.2553 10.0755 10.3066 10.2537 10.2053 10.4563C10.104 10.659 10.0527 10.7859 9.90136 10.9642C9.74877 11.1423 9.58155 11.3609 9.44482 11.4975C9.29222 11.6489 9.1335 11.815 9.31053 12.1189C9.48879 12.424 10.0991 13.4214 11.0048 14.2282C12.1694 15.2658 13.1495 15.5868 13.4547 15.7406C13.7599 15.8932 13.9368 15.8675 14.1151 15.6637C14.2934 15.4611 14.8768 14.7751 15.0794 14.4699C15.282 14.1647 15.486 14.216 15.7655 14.3173C16.045 14.4186 17.5428 15.1559 17.8467 15.3085C18.1519 15.4611 18.3545 15.5368 18.4302 15.6637C18.5059 15.7895 18.5059 16.3998 18.2519 17.1115Z" />
                            </svg>
                        </a>
                        <a v-if="toolkitStore?.settings?.soc_link_inst" :href="toolkitStore?.settings?.soc_link_inst"
                            class="min-w-[45px] h-[45px] md:min-w-[60px] md:h-[60px] border border-whiteOp-300 rounded-full hover:bg-white transition-all flex items-center justify-center group">
                            <svg class="fill-white group-hover:fill-blue-600 w-[45%] transition-all" width="25"
                                height="26" viewBox="0 0 25 26" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M12.2727 2.71001C15.5519 2.71001 15.9401 2.72443 17.2298 2.78191C18.4283 2.83468 19.0755 3.03606 19.5069 3.20389C20.0775 3.42439 20.4897 3.69285 20.9164 4.11953C21.3478 4.55092 21.6116 4.95848 21.8321 5.52895C21.9998 5.96044 22.2012 6.61243 22.2539 7.80606C22.3114 9.10052 22.3258 9.48885 22.3258 12.7631C22.3258 16.0423 22.3114 16.4306 22.2539 17.7202C22.2012 18.9187 21.9998 19.5659 21.8321 19.9974C21.6116 20.5679 21.3431 20.9801 20.9164 21.4068C20.4849 21.8383 20.0775 22.1019 19.5069 22.3224C19.0755 22.4903 18.4235 22.6915 17.2298 22.7443C15.9354 22.8019 15.5471 22.8162 12.2727 22.8162C8.99366 22.8162 8.60533 22.8019 7.31567 22.7443C6.11724 22.6915 5.46995 22.4903 5.03857 22.3224C4.46809 22.1019 4.05573 21.8335 3.62904 21.4068C3.19766 20.9753 2.934 20.5679 2.7134 19.9974C2.54567 19.5659 2.34429 18.9139 2.29152 17.7202C2.23404 16.4258 2.21962 16.0375 2.21962 12.7631C2.21962 9.48405 2.23404 9.09571 2.29152 7.80606C2.34429 6.60762 2.54567 5.96044 2.7134 5.52895C2.934 4.95848 3.20247 4.54611 3.62904 4.11953C4.06053 3.68804 4.46809 3.42439 5.03857 3.20389C5.46995 3.03606 6.12194 2.83468 7.31567 2.78191C8.60533 2.72443 8.99366 2.71001 12.2727 2.71001ZM12.2727 0.5C8.94088 0.5 8.52382 0.514421 7.21503 0.571898C5.91106 0.629477 5.01453 0.840364 4.23798 1.14238C3.42777 1.45881 2.74224 1.87587 2.06141 2.56141C1.37587 3.24214 0.958807 3.92777 0.642375 4.73317C0.340364 5.51453 0.129477 6.40625 0.0718978 7.71023C0.0144206 9.02382 0 9.44088 0 12.7727C0 16.1046 0.0144206 16.5216 0.0718978 17.8304C0.129477 19.1344 0.340364 20.0309 0.642375 20.8076C0.958807 21.6177 1.37587 22.3033 2.06141 22.984C2.74224 23.6648 3.42777 24.0866 4.23317 24.3983C5.01453 24.7003 5.90625 24.9112 7.21023 24.9687C8.51901 25.0262 8.93608 25.0406 12.2679 25.0406C15.5998 25.0406 16.0168 25.0262 17.3256 24.9687C18.6296 24.9112 19.5261 24.7003 20.3028 24.3983C21.1082 24.0866 21.7937 23.6648 22.4744 22.984C23.1552 22.3033 23.577 21.6177 23.8887 20.8123C24.1907 20.0309 24.4017 19.1392 24.4591 17.8352C24.5167 16.5264 24.531 16.1094 24.531 12.7775C24.531 9.44569 24.5167 9.02862 24.4591 7.71984C24.4017 6.41586 24.1907 5.51934 23.8887 4.74268C23.5866 3.92777 23.1696 3.24214 22.484 2.56141C21.8033 1.88068 21.1177 1.45881 20.3123 1.14718C19.5309 0.84517 18.6392 0.634284 17.3352 0.576704C16.0216 0.51442 15.6046 0.5 12.2727 0.5Z" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M19.4332 2.5459H5.11506C3.42055 2.5459 2.04688 3.91957 2.04688 5.61408V19.9323C2.04688 21.6268 3.42055 23.0004 5.11506 23.0004H19.4332C21.1278 23.0004 22.5014 21.6268 22.5014 19.9323V5.61408C22.5014 3.91957 21.1278 2.5459 19.4332 2.5459ZM12.272 6.46909C8.79152 6.46909 5.96777 9.29284 5.96777 12.7733C5.96777 16.2537 8.79152 19.0775 12.272 19.0775C15.7524 19.0775 18.5762 16.2537 18.5762 12.7733C18.5762 9.29284 15.7524 6.46909 12.272 6.46909ZM12.272 16.8626C10.014 16.8626 8.18269 15.0313 8.18269 12.7733C8.18269 10.5153 10.014 8.68401 12.272 8.68401C14.5299 8.68401 16.3612 10.5153 16.3612 12.7733C16.3612 15.0313 14.5299 16.8626 12.272 16.8626ZM18.8262 7.69141C19.6364 7.69141 20.298 7.03461 20.298 6.2196C20.298 5.4095 19.6364 4.74789 18.8262 4.74789C18.016 4.74789 17.3545 5.40469 17.3545 6.2196C17.3545 7.0298 18.0112 7.69141 18.8262 7.69141Z" />
                            </svg>
                        </a>
                        <a v-if="toolkitStore?.settings?.soc_link_fb" :href="toolkitStore?.settings?.soc_link_fb"
                            class="min-w-[45px] h-[45px] md:min-w-[60px] md:h-[60px] border border-whiteOp-300 rounded-full hover:bg-white transition-all flex items-center justify-center group">
                            <svg class="fill-white group-hover:fill-blue-600 w-[45%] transition-all" width="11"
                                height="20" viewBox="0 0 11 20" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M7.21813 20V10.8777H10.2789L10.7381 7.32156H7.21813V5.05147C7.21813 4.0222 7.50278 3.32076 8.98042 3.32076L10.862 3.31999V0.13923C10.5366 0.0969453 9.41964 0 8.11964 0C5.40505 0 3.54658 1.65697 3.54658 4.69927V7.32156H0.476562V10.8777H3.54658V20H7.21813Z" />
                            </svg>
                        </a>
                        <a v-if="toolkitStore?.settings?.soc_link_yt" :href="toolkitStore?.settings?.soc_link_yt"
                            class="min-w-[45px] h-[45px] md:min-w-[60px] md:h-[60px] border border-whiteOp-300 rounded-full hover:bg-white transition-all flex items-center justify-center group">
                            <svg class="fill-white group-hover:fill-blue-600 w-[45%] transition-all" width="20"
                                height="14" viewBox="0 0 20 14" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M18.6488 2.31398C18.4327 1.51072 17.7994 0.877518 16.9963 0.661224C15.529 0.259766 9.65993 0.259766 9.65993 0.259766C9.65993 0.259766 3.79105 0.259766 2.32381 0.646004C1.53611 0.862068 0.887344 1.51083 0.67128 2.31398C0.285156 3.78111 0.285156 6.82375 0.285156 6.82375C0.285156 6.82375 0.285156 9.88173 0.67128 11.3335C0.887573 12.1367 1.52066 12.7699 2.32392 12.9862C3.8065 13.3877 9.66016 13.3877 9.66016 13.3877C9.66016 13.3877 15.529 13.3877 16.9963 13.0015C17.7995 12.7853 18.4327 12.1521 18.649 11.349C19.035 9.88173 19.035 6.8392 19.035 6.8392C19.035 6.8392 19.0505 3.78111 18.6488 2.31398ZM7.79134 9.63465V4.01286L12.6718 6.82375L7.79134 9.63465Z" />
                            </svg>
                        </a>
                    </div>

                </div>

                <form @submit.prevent="submitForm"
                    class="flex xl:max-w-[381px] lg:max-w-full flex-col p-5 md:px-5 md:py-12 border border-whiteOp-300 rounded-2xl text-center lg:p-12 relative mb-14 md:mb-0">
                    <img src="/assets/img/index/dot-decor-2.png" class="absolute right-[-1px] bottom-[-1px] w-5 md:w-8"
                        alt="decor">
                    <h2 class="font-bold text-white md:text-2xl mb-4 3xl:text-3xl md:mb-7 leading-[100%]">
                        {{ $t('want_know_more') }}
                    </h2>
                    <div class="flex flex-col gap-3 lg:gap-0">
                        <input type="text" v-model="name" placeholder="Имя"
                            class="bg-white/10 lg:mb-[10px] rounded-xl text-white text-sm py-4 leading-[90%] px-5 outline-none md:p-5 lg:p-6 md:text-base w-full">
                        <div class="phone-vti">
                            <!-- <VueTelInput :use-masking="true" placeholder="Введите номер телефона" v-model="phone"
                                :only-countries="onlyCountries" /> -->
                                <VueTelInput :input-options="inputOptions" v-model="phone" :use-masking="true" :preferred-countries="preferredCountries" :only-countries="sortedCountries" />
                        </div>
                        <p class="text-red-700 text-left transition-all h-full" :class="{
                            'max-h-10 opacity-100 mt-2': isError,
                            'max-h-0 opacity-0': !isError
                        }">
                            {{ $t('fill_all_fields') }}
                        </p>
                        <p class="text-white/50 text-left transition-all h-full" :class="{
                            'max-h-10 opacity-100 mt-2': isSending,
                            'max-h-0 opacity-0': !isSending
                        }">
                            {{ $t('wait_for_send') }}
                        </p>
                        <p class="text-green-500 text-left transition-all h-full" :class="{
                            'max-h-10 opacity-100 mt-2': isSuccess,
                            'max-h-0 opacity-0': !isSuccess
                        }">
                            {{ $t('message_sent_successfuly') }}
                        </p>

                        <button type="submit"
                            class="white-button w-full leading-[110%] lg:mt-8 h-[48px] py-2 xl:h-[64px]">
                            {{ $t('send_mail') }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="bg-blue-500 py-7 md:py-2">
            <div class="container">
                <div class="flex items-center justify-between gap-8">
                    <!-- <img src="/assets/img/index/a-footer.png" class="max-w-[96px] md:hidden" alt="ph"> -->

                    <div class="logo-clip-path md:hidden">
                        <video loop class="w-[96px] h-[100px] object-cover" muted autoplay
                            src="/assets/video/video-logo.webm"></video>
                    </div>

                    <ul class="md:flex md:items-center py-2 md:justify-center md:w-full">
                        <li
                            class="text-white/60 text-xs lg:text-sm mb-2 md:mb-0 md:border-r md:pr-[14px] md:mr-[14px] border-white/10 last:pr-0 last:mr-0 last:border-none">
                            <p>
                                 {{ copyright }}
                            </p>
                        </li>
                        <li
                            class="text-white/60 text-xs lg:text-sm mb-2 md:mb-0 md:border-r md:pr-[14px] md:mr-[14px] border-white/10 last:pr-0 last:mr-0 last:border-none">
                            <NuxtLink href="/docs/privacy-police" class="hover:text-blue-400 transition-all">
                                {{ allPages?.filter(item => item.slug === 'privacy-police')[0]?.translations?.filter(item => item.languages_code.includes(langStore.lang))[0]?.title }}
                            </NuxtLink>
                        </li>
                        <li
                            class="text-white/60 text-xs lg:text-sm mb-2 md:mb-0 md:border-r md:pr-[14px] md:mr-[14px] border-white/10 last:pr-0 last:mr-0 last:border-none">
                            <NuxtLink href="/docs/terms" class="hover:text-blue-400 transition-all">
                                {{ allPages?.filter(item => item.slug === 'terms')[0]?.translations?.filter(item => item.languages_code.includes(langStore.lang))[0]?.title }}
                            </NuxtLink>
                        </li>
                        <li
                            class="text-white/60 text-xs lg:text-sm mb-2 md:mb-0 md:border-r md:pr-[14px] md:mr-[14px] border-white/10 last:pr-0 last:mr-0 last:border-none">
                            <NuxtLink href="/cooperation" class="hover:text-blue-400 transition-all">
                                {{ allPages?.filter(item => item.slug === 'cooperation')[0]?.translations?.filter(item => item.languages_code.includes(langStore.lang))[0]?.title }}
                            </NuxtLink>
                        </li>
                        <li
                            class="text-white/60 text-xs lg:text-sm mb-2 md:mb-0 md:border-r md:pr-[14px] md:mr-[14px] border-white/10 last:pr-0 last:mr-0 last:border-none">
                            <NuxtLink href="/career" class="hover:text-blue-400 transition-all">
                                {{ allPages?.filter(item => item.slug === 'career')[0]?.translations?.filter(item => item.languages_code.includes(langStore.lang))[0]?.title }}
                            </NuxtLink>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
</template>


<script setup>
import { ref, watch } from 'vue';
import { usePagesStore } from '~/stores/functions/pages';
import { useToolkit } from '~/stores/functions/toolkit';
import { VueTelInput } from 'vue-tel-input';
import 'vue-tel-input/vue-tel-input.css';
import iso31661 from 'iso-3166-1';

const pagesStore = usePagesStore();
const langStore = useLangStore();
const allPages = ref([]);

watch(pagesStore, (newValue) => {
    allPages.value = newValue?.pagesList;
});

const name = ref(null);
const phone = ref(null);
const isError = ref(null);
const isSending = ref(false);
const isSuccess = ref(false);

const toolkitStore = useToolkit();

const resetForm = () => {
    name.value = '';
    phone.value = '';
};

const placeholderLang = {
    'ru': 'Введите ваш номер телефона',
    'en': 'Enter your phone number',
    'ua': 'Введіть ваш номер телефону'
}

const inputOptions = {
  placeholder: placeholderLang[langStore.lang]
};

const submitForm = async () => {
    if (!name.value || !phone.value) {
        isError.value = true;
        return;
    } else {
        isError.value = false;
    }

    isSending.value = true;

    try {
        const { data } = await useFetch('https://crm.g-plus.app/api/actions', {
            method: 'POST',
            body: {
                action: 'partner-custom-form',
                token: 'BnYxulkF_XC5Aq7Re9oO80vbIu-ZblVbALCDNDdAJE0',
                partner_id: '25545',
                name: name.value,
                phone: phone.value,
                // building_id: '123',
                lang: 'ua',
                note: 'Запит з форми контактів',
                // adv_id: '123123123'
            }
        });

        isSending.value = false;
        isSuccess.value = true;
        resetForm();
    } catch (err) {
        console.log('11111', err);
        isSending.value = false;
    }
};

const preferredCountries = [
  'id', // Индонезия
  'ua', // Украина
  'ru', // Россия
  'by', // Беларусь
  'kz', // Казахстан
  'us', // США
  'gb', // Англия
  'fr', // Франция
  'cn', // КНР
];

const allCountries = iso31661.all().map(country => country.alpha2);

const sortedCountries = computed(() => {
  const preferredSet = new Set(preferredCountries);
  const unselectedCountries = allCountries.filter(country => !preferredSet.has(country));
  return [...preferredCountries, ...unselectedCountries];
});


const copyright = `© ${new Date().getFullYear()} PT Avalon Group Bali`

</script>
